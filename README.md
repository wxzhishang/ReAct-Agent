# ReAct Agent

åŸºäº ReActï¼ˆReasoning and Actingï¼‰æ¶æ„çš„ AI Agent å®ç°ï¼Œä½¿ç”¨ TypeScript å’Œ Bun è¿è¡Œæ—¶ã€‚

## ğŸŒŸ ç‰¹æ€§

- âœ… **ReAct æ¶æ„**ï¼šå®ç°æ€è€ƒï¼ˆReasoningï¼‰å’Œè¡ŒåŠ¨ï¼ˆActingï¼‰çš„å®Œæ•´å¾ªç¯
- ğŸ› ï¸ **å¯æ‰©å±•å·¥å…·ç³»ç»Ÿ**ï¼šè½»æ¾æ·»åŠ è‡ªå®šä¹‰å·¥å…·
- ğŸŒ **çœŸå® API é›†æˆ**ï¼šæ”¯æŒçœŸå®æœç´¢å’Œå¤©æ°”æŸ¥è¯¢ï¼ˆå¯é€‰ï¼‰
- ğŸ’¬ **äº¤äº’å¼é—®ç­”**ï¼šå‘½ä»¤è¡Œäº¤äº’å¼å¯¹è¯
- ğŸ§  **å¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡**ï¼šæ”¯æŒè¿ç»­æé—®ï¼Œè‡ªåŠ¨è®°å¿†å¯¹è¯å†å²
- ğŸ”„ **é˜²å¾ªç¯æœºåˆ¶**ï¼šæ™ºèƒ½æ£€æµ‹å’Œé˜²æ­¢é‡å¤æ“ä½œ
- ğŸ“Š **è¯¦ç»†æ—¥å¿—**ï¼šå¯è§†åŒ– Agent çš„æ€è€ƒå’Œå†³ç­–è¿‡ç¨‹
- ğŸ”§ **å†…ç½®å·¥å…·**ï¼šè®¡ç®—å™¨ã€æœç´¢ã€å¤©æ°”æŸ¥è¯¢
- ğŸš€ **é«˜æ€§èƒ½**ï¼šä½¿ç”¨ Bun è¿è¡Œæ—¶ï¼Œå¿«é€Ÿé«˜æ•ˆ
- ğŸ“ **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰

## ğŸ“¦ æŠ€æœ¯æ ˆ

- **Bun** - JavaScript/TypeScript è¿è¡Œæ—¶
- **TypeScript** - ç±»å‹å®‰å…¨
- **OpenAI SDK** - LLM è°ƒç”¨ï¼ˆæ”¯æŒè‡ªå®šä¹‰ç«¯ç‚¹ï¼‰
- **Zod** - æ•°æ®éªŒè¯
- **MathJS** - æ•°å­¦è®¡ç®—
- **Consola** - ç¾è§‚çš„æ—¥å¿—è¾“å‡º

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
bun install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
# OpenAI API é…ç½®ï¼ˆå¿…éœ€ï¼‰
OPENAI_API_KEY=your-api-key-here
OPENAI_BASE_URL=your-base-url
OPENAI_MODEL=your-model-choice

# æœç´¢ API é…ç½®ï¼ˆå¯é€‰ - ä½¿ç”¨çœŸå®æœç´¢ï¼‰
# SERPER_API_KEY=your-serper-api-key

# å¤©æ°” API é…ç½®ï¼ˆå¯é€‰ - ä½¿ç”¨çœŸå®å¤©æ°”ï¼‰
# AMAP_API_KEY=your-amap-api-key
```

**è·å– API Keyï¼š**
- SiliconFlowï¼ˆæ¨èï¼‰: https://cloud.siliconflow.cn/account/ak
- Serper æœç´¢: æš‚ä¸æ”¯æŒ
- é«˜å¾·åœ°å›¾å¼€æ”¾å¹³å°: https://console.amap.com/dev/key/app

### 3. è¿è¡Œç¨‹åº

```bash
bun run start
```

### 4. å¼€å§‹æé—®

```
ğŸ¤” è¯·è¾“å…¥ä½ çš„é—®é¢˜: è®¡ç®— 123 + 456
ğŸ¤” è¯·è¾“å…¥ä½ çš„é—®é¢˜: åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ
ğŸ¤” è¯·è¾“å…¥ä½ çš„é—®é¢˜: æœç´¢äººå·¥æ™ºèƒ½çš„æœ€æ–°è¿›å±•
```

è¾“å…¥ `exit` æˆ– `quit` é€€å‡ºç¨‹åºã€‚

## ğŸ“– ä½¿ç”¨æ–¹æ³•

### äº¤äº’å¼æ¨¡å¼ï¼ˆæ¨èï¼‰

è¿è¡Œä¸»ç¨‹åºï¼Œè¿›å…¥äº¤äº’å¼é—®ç­”ï¼š

```bash
bun run start
```

æ”¯æŒçš„å‘½ä»¤ï¼š
- ç›´æ¥è¾“å…¥é—®é¢˜ - Agent ä¼šè‡ªåŠ¨æ¨ç†
- `exit` æˆ– `quit` - é€€å‡ºç¨‹åº
- `clear` - æ¸…ç©ºå±å¹•
- `reset` - æ¸…é™¤å¯¹è¯å†å²
- `history` - æŸ¥çœ‹å¯¹è¯å†å²
- `Ctrl+C` - å¼ºåˆ¶é€€å‡º

**å¤šè½®å¯¹è¯ç¤ºä¾‹ï¼š**

```
ğŸ¤” è¯·è¾“å…¥ä½ çš„é—®é¢˜: åŸƒè²å°”é“å¡”çš„é«˜åº¦æ˜¯å¤šå°‘ç±³ï¼Ÿ
âœ… ç­”æ¡ˆ: åŸƒè²å°”é“å¡”çš„é«˜åº¦æ˜¯324ç±³ã€‚

ğŸ¤” è¯·è¾“å…¥ä½ çš„é—®é¢˜: æŠŠåˆšæ‰æŸ¥åˆ°çš„é«˜åº¦ä¹˜ä»¥2å†åŠ ä¸Š100ï¼Œç»“æœæ˜¯å¤šå°‘ï¼Ÿ
âœ… ç­”æ¡ˆ: è®¡ç®—ç»“æœæ˜¯748ç±³ã€‚(324 Ã— 2 + 100 = 748)

ğŸ¤” è¯·è¾“å…¥ä½ çš„é—®é¢˜: ç°åœ¨æŠŠåŸå§‹é«˜åº¦å’Œåˆšæ‰çš„è®¡ç®—ç»“æœç›¸åŠ 
âœ… ç­”æ¡ˆ: 324 + 748 = 1072ç±³
```

Agent ä¼šè‡ªåŠ¨è®°ä½ä¹‹å‰çš„å¯¹è¯å†…å®¹ï¼Œå¯ä»¥è¿ç»­æé—®è€Œæ— éœ€é‡å¤è¯´æ˜ä¸Šä¸‹æ–‡ã€‚

### ç¨‹åºåŒ–ä½¿ç”¨

```typescript
import {
  ReActAgent,
  ToolRegistry,
  CalculatorTool,
  SearchTool,
  WeatherTool,
} from "./src/index.ts";

// 1. åˆ›å»ºå·¥å…·æ³¨å†Œè¡¨
const toolRegistry = new ToolRegistry();
toolRegistry.register(new CalculatorTool());
toolRegistry.register(new SearchTool());
toolRegistry.register(new WeatherTool());

// 2. åˆ›å»º Agent
const agent = new ReActAgent(
  process.env.OPENAI_API_KEY!,
  toolRegistry,
  {
    model: process.env.OPENAI_MODEL || "Qwen/Qwen2.5-72B-Instruct",
    baseURL: process.env.OPENAI_BASE_URL || "https://api.siliconflow.cn/v1",
    maxIterations: 10,
    temperature: 0,
    verbose: true,
  }
);

// 3. è¿è¡ŒæŸ¥è¯¢ï¼ˆæ”¯æŒå¤šè½®å¯¹è¯ï¼‰
const result1 = await agent.run("åŸƒè²å°”é“å¡”æœ‰å¤šé«˜ï¼Ÿ");
console.log(result1.answer); // ç­”æ¡ˆï¼š324ç±³

// ç¬¬äºŒè½®å¯¹è¯ - Agent ä¼šè®°ä½ç¬¬ä¸€è½®çš„å†…å®¹
const result2 = await agent.run("æŠŠåˆšæ‰çš„é«˜åº¦ä¹˜ä»¥2");
console.log(result2.answer); // ç­”æ¡ˆï¼š648ç±³

// ç®¡ç†å¯¹è¯å†å²
console.log(agent.getHistorySummary()); // æŸ¥çœ‹å†å²æ‘˜è¦
agent.clearHistory(); // æ¸…é™¤å†å²
const history = agent.getHistory(); // è·å–å®Œæ•´å†å²
```

## ğŸ› ï¸ å†…ç½®å·¥å…·

### 1. Calculatorï¼ˆè®¡ç®—å™¨ï¼‰

æ‰§è¡Œæ•°å­¦è®¡ç®—ï¼Œæ”¯æŒåŸºæœ¬ç®—æœ¯å’Œæ•°å­¦å‡½æ•°ã€‚

```typescript
"è®¡ç®— (123 + 456) * 789"
"sqrt(144) + 2^3 ç­‰äºå¤šå°‘ï¼Ÿ"
```

### 2. Searchï¼ˆæœç´¢ï¼‰

åœ¨äº’è”ç½‘ä¸Šæœç´¢ä¿¡æ¯ã€‚

- **çœŸå®æœç´¢**ï¼šé…ç½® `SERPER_API_KEY` åä½¿ç”¨ Google æœç´¢
- **å†…ç½®çŸ¥è¯†åº“**ï¼šæœªé…ç½®æ—¶ä½¿ç”¨å†…ç½®æ•°æ®ï¼ˆfallbackï¼‰

```typescript
"æœç´¢äººå·¥æ™ºèƒ½çš„æœ€æ–°è¿›å±•"
"åŸƒè²å°”é“å¡”æ˜¯ä»€ä¹ˆï¼Ÿ"
```

### 3. Weatherï¼ˆå¤©æ°”æŸ¥è¯¢ï¼‰

æŸ¥è¯¢åŸå¸‚å¤©æ°”ä¿¡æ¯ï¼ˆä½¿ç”¨é«˜å¾·åœ°å›¾APIï¼‰ã€‚

- **çœŸå®å¤©æ°”**ï¼šé…ç½® `AMAP_API_KEY` åä½¿ç”¨é«˜å¾·åœ°å›¾å®æ—¶å¤©æ°”æ•°æ®
- **æ”¯æŒèŒƒå›´**ï¼šå…¨å›½æ‰€æœ‰çœå¸‚åŒºå¿ï¼ˆ3200+ ä¸ªåŸå¸‚ï¼‰
- **æŸ¥è¯¢æ¨¡å¼**ï¼šæ”¯æŒå®æ—¶å¤©æ°”å’Œå¤©æ°”é¢„æŠ¥

```typescript
"åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
"æŸ¥è¯¢æ­å·æœªæ¥å‡ å¤©çš„å¤©æ°”é¢„æŠ¥"
"æ·±åœ³ç°åœ¨çš„å¤©æ°”å¦‚ä½•ï¼Ÿ"
```

## ğŸ”§ è‡ªå®šä¹‰å·¥å…·

åˆ›å»ºè‡ªå®šä¹‰å·¥å…·éå¸¸ç®€å•ï¼š

```typescript
import { z } from "zod";
import { Tool } from "./src/tools/base.ts";
import type { ToolResult } from "./src/agent/types.ts";

export class MyCustomTool extends Tool {
  name = "my_tool";
  description = "è¿™æ˜¯æˆ‘çš„è‡ªå®šä¹‰å·¥å…·";

  schema = z.object({
    input: z.string().describe("è¾“å…¥å‚æ•°"),
  });

  async execute(input: any): Promise<ToolResult> {
    try {
      const parsed = this.schema.parse(input);
      
      // å®ç°ä½ çš„å·¥å…·é€»è¾‘
      const result = `å¤„ç†ç»“æœ: ${parsed.input}`;

      return {
        success: true,
        data: result,
      };
    } catch (error) {
      return {
        success: false,
        error: error.message,
      };
    }
  }
}

// æ³¨å†Œå·¥å…·
toolRegistry.register(new MyCustomTool());
```

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
ReAct-Agent/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ agent/
â”‚   â”‚   â”œâ”€â”€ react-agent.ts      # ReAct Agent æ ¸å¿ƒå®ç°
â”‚   â”‚   â””â”€â”€ types.ts             # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ tools/
â”‚   â”‚   â”œâ”€â”€ base.ts              # Tool åŸºç±»å’Œæ³¨å†Œè¡¨
â”‚   â”‚   â”œâ”€â”€ calculator.ts        # è®¡ç®—å™¨å·¥å…·
â”‚   â”‚   â”œâ”€â”€ search.ts            # æœç´¢å·¥å…·ï¼ˆçœŸå®APIï¼‰
â”‚   â”‚   â”œâ”€â”€ weather.ts           # å¤©æ°”å·¥å…·ï¼ˆçœŸå®APIï¼‰
â”‚   â”‚   â””â”€â”€ index.ts             # å·¥å…·å¯¼å‡º
â”‚   â”œâ”€â”€ prompts/
â”‚   â”‚   â””â”€â”€ react-prompt.ts      # Prompt æ¨¡æ¿
â”‚   â””â”€â”€ index.ts                 # ä¸»å…¥å£
â”œâ”€â”€ examples/                    # ç¤ºä¾‹ä»£ç 
â”œâ”€â”€ index.ts                     # äº¤äº’å¼ä¸»ç¨‹åº
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

## ğŸ¯ ReAct å·¥ä½œåŸç†

ReAct (Reasoning and Acting) æ˜¯ä¸€ç§è®© LLM äº¤æ›¿è¿›è¡Œæ¨ç†å’Œè¡ŒåŠ¨çš„æ–¹æ³•ï¼š

1. **Thoughtï¼ˆæ€è€ƒï¼‰**ï¼šAgent åˆ†æé—®é¢˜ï¼Œæ€è€ƒéœ€è¦åšä»€ä¹ˆ
2. **Actionï¼ˆè¡ŒåŠ¨ï¼‰**ï¼šå¦‚æœéœ€è¦æ›´å¤šä¿¡æ¯ï¼Œé€‰æ‹©å¹¶æ‰§è¡Œä¸€ä¸ªå·¥å…·
3. **Observationï¼ˆè§‚å¯Ÿï¼‰**ï¼šè§‚å¯Ÿå·¥å…·è¿”å›çš„ç»“æœ
4. **å¾ªç¯**ï¼šåŸºäºè§‚å¯Ÿç»“æœç»§ç»­æ€è€ƒï¼Œç›´åˆ°èƒ½ç»™å‡ºæœ€ç»ˆç­”æ¡ˆ

### ç¤ºä¾‹æ‰§è¡Œæµç¨‹

```
é—®é¢˜: "åŸƒè²å°”é“å¡”çš„é«˜åº¦ä¹˜ä»¥2æ˜¯å¤šå°‘ï¼Ÿ"

è¿­ä»£ 1:
  ğŸ’­ æ€è€ƒ: æˆ‘éœ€è¦å…ˆçŸ¥é“åŸƒè²å°”é“å¡”çš„é«˜åº¦
  ğŸ”§ è¡ŒåŠ¨: search
  ğŸ“¥ è¾“å…¥: {"query": "åŸƒè²å°”é“å¡”"}
  ğŸ‘€ è§‚å¯Ÿ: åŸƒè²å°”é“å¡”é«˜324ç±³

è¿­ä»£ 2:
  ğŸ’­ æ€è€ƒ: ç°åœ¨æˆ‘çŸ¥é“é«˜åº¦æ˜¯324ç±³ï¼Œéœ€è¦è®¡ç®—324*2
  ğŸ”§ è¡ŒåŠ¨: calculator
  ğŸ“¥ è¾“å…¥: {"expression": "324 * 2"}
  ğŸ‘€ è§‚å¯Ÿ: 648

è¿­ä»£ 3:
  ğŸ’­ æ€è€ƒ: æˆ‘å·²ç»å¾—åˆ°äº†ç­”æ¡ˆ
  âœ… æœ€ç»ˆç­”æ¡ˆ: åŸƒè²å°”é“å¡”çš„é«˜åº¦æ˜¯324ç±³ï¼Œä¹˜ä»¥2ç­‰äº648ç±³
```

## ğŸ§  å¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡

Agent æ”¯æŒå¤šè½®å¯¹è¯ï¼Œèƒ½å¤Ÿè®°ä½ä¹‹å‰çš„å¯¹è¯å†…å®¹å¹¶åœ¨åç»­é—®é¢˜ä¸­å¼•ç”¨ã€‚

### å·¥ä½œåŸç†

- æ¯æ¬¡å¯¹è¯å®Œæˆåï¼Œé—®é¢˜å’Œç­”æ¡ˆä¼šè‡ªåŠ¨ä¿å­˜åˆ°å¯¹è¯å†å²ä¸­
- ä¸‹æ¬¡æé—®æ—¶ï¼ŒAgent å¯ä»¥è®¿é—®å®Œæ•´çš„å¯¹è¯å†å²
- æ”¯æŒå¼•ç”¨ä¹‹å‰çš„æŸ¥è¯¢ç»“æœã€è®¡ç®—ç»“æœç­‰ä¿¡æ¯

### API æ–¹æ³•

```typescript
// è·å–å¯¹è¯å†å²æ‘˜è¦
const summary = agent.getHistorySummary();
// è¾“å‡º: "å…± 3 è½®å¯¹è¯ï¼Œ6 æ¡æ¶ˆæ¯"

// è·å–å®Œæ•´å¯¹è¯å†å²
const history = agent.getHistory();
// è¿”å›: ConversationMessage[] æ•°ç»„

// æ¸…é™¤å¯¹è¯å†å²
agent.clearHistory();
```

### ä½¿ç”¨ç¤ºä¾‹

æŸ¥çœ‹ `examples/context-conversation-example.ts` äº†è§£å®Œæ•´ç¤ºä¾‹ï¼š

```bash
bun run examples/context-conversation-example.ts
```

**ç¤ºä¾‹å¯¹è¯æµç¨‹ï¼š**

```typescript
// ç¬¬ä¸€è½®ï¼šæŸ¥è¯¢ä¿¡æ¯
const result1 = await agent.run("åŸƒè²å°”é“å¡”çš„é«˜åº¦æ˜¯å¤šå°‘ç±³ï¼Ÿ");
// ç­”æ¡ˆï¼š324ç±³

// ç¬¬äºŒè½®ï¼šåŸºäºç¬¬ä¸€è½®çš„ç»“æœè®¡ç®—ï¼ˆæ— éœ€é‡å¤è¯´æ˜é«˜åº¦ï¼‰
const result2 = await agent.run("æŠŠåˆšæ‰çš„é«˜åº¦ä¹˜ä»¥2å†åŠ ä¸Š100");
// ç­”æ¡ˆï¼š748ç±³ (324 Ã— 2 + 100)

// ç¬¬ä¸‰è½®ï¼šå¼•ç”¨å‰ä¸¤è½®çš„ç»“æœ
const result3 = await agent.run("æŠŠç¬¬ä¸€è½®çš„åŸå§‹å€¼å’Œç¬¬äºŒè½®çš„ç»“æœç›¸åŠ ");
// ç­”æ¡ˆï¼š1072ç±³ (324 + 748)
```

## âš™ï¸ é…ç½®é€‰é¡¹

```typescript
interface AgentConfig {
  model?: string;           // OpenAI æ¨¡å‹ï¼Œé»˜è®¤ "Qwen/Qwen2.5-72B-Instruct"
  baseURL?: string;         // API ç«¯ç‚¹ï¼Œé»˜è®¤ SiliconFlow
  maxIterations?: number;   // æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œé»˜è®¤ 10
  temperature?: number;     // æ¸©åº¦å‚æ•°ï¼Œé»˜è®¤ 0
  verbose?: boolean;        // æ˜¯å¦æ˜¾ç¤ºè¯¦ç»†æ—¥å¿—ï¼Œé»˜è®¤ false
}
```